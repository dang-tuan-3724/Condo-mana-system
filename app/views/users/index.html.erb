<div class="space-y-4 mb-8 flex justify-center items-center flex-col w-full">
  <h1 class="font-bold text-4xl">CMS's Members</h1>
  <div class="mb-6 flex flex-wrap gap-2 justify-center">
    <%= link_to "All", users_path, class: "px-4 py-2 rounded-full #{params[:condo_id].blank? ? 'bg-blue-500 text-white' : 'bg-gray-200 hover:bg-gray-300'}" %>
    <% @condos.each do |condo| %>
      <%= link_to condo.name, users_path(condo_id: condo.id), class: "px-4 py-2 rounded-full #{params[:condo_id] == condo.id.to_s ? 'bg-blue-500 text-white' : 'bg-blue-200 hover:bg-blue-300'}" %>
    <% end %>
  </div>
  <%= form_with url: users_path, method: :get, local: true, class: "mb-6 border border-blue-500 rounded flex justify-between px-4 shadow-md w-full" do |f| %>
    <input type="text" name="search" value="<%= params[:search] %>" placeholder="Search for user by name, email or unit name" style="width: 90%;" class="rounded px-2 py-1 bg-white focus:bg-white focus:outline-none focus:ring-0 " />
    <button type="submit" class=" " >
      <%= heroicon "magnifying-glass", options: { class: "w-4 h-4 inline-block mr-2 text-blue-600" } %>
      Search
    </button>
  <% end %>
  <% if params[:condo_id].present? %>
    <% selected_condo = @condos.find { |c| c.id.to_s == params[:condo_id] } %>
    <div class="justify-center mb-4 p-3 bg-blue-50 rounded border-l-4 border-blue-400">
      <p class="text-blue-700">
        Showing <%= @users.count %> members in your authorized scope: <strong><%= selected_condo&.name %></strong> 
      </p>
    </div>
  <% else %>
    <div class="justify-center mb-4 p-3 bg-gray-50 rounded border-l-4 border-blue-400">
      <p class="text-gray-700">Showing all <%= @users.count %> members in your authorized scope</p>
    </div>
  <% end %>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 w-auto self-center">
  <% @users.each do |user| %>
      <div id="member-container" class="bg-blue-100 mb-2 rounded p-4 border border-blue-200 min-h-64 flex flex-col justify-between hover:bg-blue-200 transition duration-300">
        <div>
        <%= link_to user_path(user), class: "w-full" do %>
          <h1 class="font-semibold"><%= user.first_name %> <%= user.last_name %></h1>
            <p class="break-words whitespace-normal"><b>Email:</b> <%= user.email %></p>
          <p><b>Role:</b> <%= user.role %></p>
          <% if user.condo&.name %>
            <p><b>Condo:</b> <%= user.condo&.name %></p>
        <% end %>
        
        <% if user.all_related_units.present? %>
          <% user.all_related_units.each do |unit| %>
            <p><b>Unit:</b> <%= unit.unit_number %> (Floor: <%= unit.floor %>)</p>
          <% end %>
        <% end %>
        </div>
          <div class=" flex flex-row text-blue-600 items-center">
          <%= form_with url: user_path(user), method: :delete, local: true do |f| %>
            <button type="submit" class="flex flex-row text-blue-600 items-center justify-between w-full bg-transparent border-none p-0 hover:text-red-600" style="background: none; border: none;">
              <i class="fa-solid fa-trash text-lg"></i>
              <span class="ml-2">Delete</span>
            </button>
          <% end %>
          </div>
        <% end %>
      </div>

  <% end %>
  </div>
  <div class="inline-flex">
    <%= link_to 'New members', new_user_path, class: "inline-flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 whitespace-nowrap" %>
  </div>
</div>
