<div class="w-full mb-8">
  <div class="mb-6">
    <h1 class="font-bold text-4xl">All Bookings</h1>
    <p>Displaying all bookings in your authorized scope</p>
  </div>
  <%= form_with url: bookings_path, method: :get, local: true, class: "mb-6 border border-blue-500 rounded flex justify-between px-4 shadow-md w-full" do |f| %>
    <input type="text" name="search" value="<%= params[:search] %>" placeholder="Search for booking by facility, user email" style="width: 90%;" class="rounded px-2 py-1 bg-white focus:bg-white focus:outline-none focus:ring-0 " />
    <select name="status" id="" class=" px-2 py-1 ml-2">
      <option value="">All status</option>
      <option value="pending" <%= 'selected' if params[:status] == 'pending' %>>Pending</option>
      <option value="approved" <%= 'selected' if params[:status] == 'approved' %>>Approved</option>
      <option value="rejected" <%= 'selected' if params[:status] == 'rejected' %>>Rejected</option>
      <option value="cancelled" <%= 'selected' if params[:status] == 'cancelled' %>>Cancelled</option>
    </select>
    <input class=" px-2 py-1 ml-2 mr-2s" style="width: 20%;" type="date" name="day" value="<%= params[:day] %>">
    <button type="submit" class=" " >
  <%= heroicon "magnifying-glass", options: { class: "w-4 h-4 inline-block mr-2 text-blue-600" } %>
  <span class="hidden md:inline">Search</span>
    </button>
  <% end %>
  <div class="flex flex-col gap-4">
    <% @bookings.each do |booking| %>
      <div class="bg-blue-100  rounded-lg p-4 border border-blue-200 w-full max-w-2xl mx-auto flex flex-col sm:flex-row sm:items-center justify-between">
        <div>
          <h2 class="text-xl font-semibold mb-2 text-blue-700"><%= booking.facility.name %></h2>
          <div class="text-sm text-gray-600 space-y-1">
            <p><span class="font-medium">User Email:</span> <%= booking.user.email %></p>
            <% if booking.purpose.present? %>
              <p><span class="font-medium">Purpose:</span> <%= booking.purpose %></p>
            <% end %>
            <% if booking.booking_time_slots.present? %>
              <div>
                <span class="font-medium">Time Slots:</span>
                <div class="mt-1">
                  <% booking.booking_time_slots.each do |date, time_slots| %>
                    <div class="mb-2">
                      <span class="text-xs font-medium text-gray-500"><%= date %></span>
                      <div class="flex flex-wrap gap-1 mt-1">
                        <% Array(time_slots).each do |slot| %>
                          <span class="bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs border border-blue-200"><%= slot %></span>
                        <% end %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
            <p><span class="font-medium">Status:</span>
              <%= form_with url: booking_path(booking), method: :patch, local: true, html: { class: 'inline' } do |f| %>
                <%= f.select :status, options_for_select([
                  ['Pending', 'pending'],
                  ['Approved', 'approved'],
                  ['Rejected', 'rejected'],
                  ['Cancelled', 'cancelled']
                ], booking.status), {},
                {
                  class: "rounded-full border-2 px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-300 transition-colors " +
                    (booking.status == 'pending' ? 'border-orange-400 bg-orange-200 text-orange-700' :
                    booking.status == 'approved' ? 'border-green-500 bg-green-200 text-green-700' :
                    booking.status == 'rejected' ? 'border-red-500 bg-red-200 text-red-700' :
                    booking.status == 'canceled' ? 'border-yellow-900 bg-yellow-200 text-yellow-900' :
                    'border-gray-300'),
                  onchange: 'this.form.submit()'
                }
                %>
              <% end %>
            </p>
          </div>
        </div>
        <div class="flex flex-col justify-between mt-3 sm:mt-0 sm:ml-6 pt-3 sm:pt-0 border-t sm:border-t-0 sm:border-l border-blue-200 sm:pl-6">
          <%= form_with url: booking_path(booking), method: :delete, local: true, class: "inline" do |f| %>
            <%= f.submit 'Delete', class: "text-red-600 hover:text-red-800 cursor-pointer text-sm transition-colors", data: { confirm: "Are you sure you want to delete this booking?" } %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

</div>
